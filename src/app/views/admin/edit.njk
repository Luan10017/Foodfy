{% extends "layouts/admin.njk" %}

{%block contentAdmin%}

    <div class="admin-content">
        <form method="POST" action="/admin/recipes?_method=PUT">
            <div class="sub_title_info">
                <h1>Editando receita</h1>
                <button class="button" type="submit">Salvar</button>
            </div>
            
            {% include 'admin/fields.njk' %}

            <input type="hidden" name="id" value="{{recipe.id}}">
        </form>
        <form method="POST" id="form-delete" action="/admin/recipes?_method=DELETE">
            <input type="hidden" name="id" value="{{recipe.id}}">
            <button type="submit">Deletar</button>
        </form>
    </div>







    <script>
        /* ===  ADMIN INGREDIENT === */
        function addIngredient() {
            const ingredients = document.querySelector("#ingredients");
            const fieldContainer = document.querySelectorAll(".ingredient");

            // Realiza um clone do último ingrediente adicionado
            const newField = fieldContainer[fieldContainer.length-1].cloneNode(true); 
            // Não adiciona um novo input se o último tem um valor vazio
            if (newField.children[0].value == "") return false;
            
            // Deixa o valor do input vazio
            newField.children[0].value = "";
            ingredients.appendChild(newField);
        }

        const ingredientButton = document.querySelector(".add-button.ingredients")
        ingredientButton.addEventListener('click', addIngredient);

        /* ===  ADMIN STEPS === */

        function addStep() {
            const steps = document.querySelector("#steps");
            const fieldContainer = document.querySelectorAll(".step");

            // Realiza um clone do último ingrediente adicionado
            const newField = fieldContainer[fieldContainer.length - 1].cloneNode(true);

            // Não adiciona um novo input se o último tem um valor vazio
            if (newField.children[0].value == "") 
                return false;
            
            // Deixa o valor do input vazio
            newField.children[0].value = "";
            steps.appendChild(newField);
        }

        const stepButton = document.querySelector(".add-button.steps")
        stepButton.addEventListener('click', addStep);

        /* CONTROLE DELETE */
        const formDelete = document.querySelector("#form-delete")
        formDelete.addEventListener("submit", function (event) {
            const confirmation = confirm("Deseja Deletar?")
            if (!confirmation) {
                event.preventDefault()
            }
        })
    </script>
{% endblock %}