{% extends "admin/layout.njk" %}

{%block contentAdmin%}
    <form class="admin-content" method="post" action="/admin/recipes">
        <div class="presentation">
            <h1>Criando receita</h1>
            <button type="submit" class="button-admin-recipe">Salvar receita</button>
        </div>
        <main>
            <div class="item">
                <div>Foto da receita</div>
                <div>
                    <input type="URL" name="image" placeholder="http://">
                </div>
            </div>
            <div class="item">
                <div>Título</div>
                <div>
                    <input type="text" name="title" placeholder="Título da receita">
                </div>
            </div>
            <div class="item">
                <div>Autor</div>
                <div>
                    <input type="text" name="author" placeholder="Nome do autor">
                </div>
            </div>
            <div class="item">
                <div>Ingredientes</div>
                <div id="ingredients">
                    <div class="ingredient">
                        <input type="text" name="ingredients[]" placeholder="Ingredientes">
                    </div>
                </div>
                <a class="add-button ingredients">Adicionar novo ingrediente</a>
            </div>
            <div class="item">
                <div>Modo de preparo</div>
                <div id="steps">
                    <div class="step">
                        <input type="text" name="preparation[]" value="{{step}}">
                    </div>
                </div>
                <a class="add-button steps">Adicionar novo passo</a>
            </div>
            <div class="item">
                <div>informações adicionais</div>
                <div>
                    <textarea name="information" cols="30" rows="10">
                        {{recipe.information}}
                    </textarea>
                </div>
            </div>
        </main>
    </form>
    <script>
        /* ===  ADMIN INGREDIENT === */

        function addIngredient() {
            const ingredients = document.querySelector("#ingredients");
            const fieldContainer = document.querySelectorAll(".ingredient");

            // Realiza um clone do último ingrediente adicionado
            const newField = fieldContainer[fieldContainer.length - 1].cloneNode(true);

            // Não adiciona um novo input se o último tem um valor vazio
            if (newField.children[0].value == "") 
                return false;
            
            // Deixa o valor do input vazio
            newField
                .children[0]
                .value = "";
            ingredients.appendChild(newField);
        }

        const ingredientButton = document.querySelector(".add-button.ingredients")
        ingredientButton.addEventListener('click', addIngredient);

        /* ===  ADMIN STEPS === */

        function addStep() {
            const steps = document.querySelector("#steps");
            const fieldContainer = document.querySelectorAll(".step");

            // Realiza um clone do último ingrediente adicionado
            const newField = fieldContainer[fieldContainer.length - 1].cloneNode(true);

            // Não adiciona um novo input se o último tem um valor vazio
            if (newField.children[0].value == "") 
                return false;
            
            // Deixa o valor do input vazio
            newField
                .children[0]
                .value = "";
            steps.appendChild(newField);
        }

        const stepButton = document.querySelector(".add-button.steps")
        stepButton.addEventListener('click', addStep);
    </script>
{% endblock %}